{% extends "base.html" %}
{% load static %}
{% load shopping_cart_tools %}

{% block tab_title %}| Make Payment{% endblock %}

{% block checkout %}
    <section class="footer-pusher">
        <h2 class="text-capitalize mt-3">make payment</h2>

        <div class="drink-order-box col-12 text-left px-0">
            
            <p class="text-body text-center font-weight-bolder mb-1">Order Summary ({{ drink_counter }})</p>  
            <div class="container">
                <div class="row">     
                    <div class="shopping-cart-costs text-left col-12 pl-1"> 
                        <ul class="font-weight-bolder text-capitalize mb-1">
                            <li>subtotal: <span class="font-weight-normal">£{{ subtotal|floatformat:2 }}</span> </li>
                            <li>delivery: <span class="font-weight-normal">£{{ delivery|floatformat:2 }}</span></li>
                            <li>grand total: <span class="font-weight-normal">£{{ grand_total|floatformat:2 }}</span></li>
                        </ul>
                    </div> 
                </div>
            </div>
            <hr class="m-0 p-0 mx-2 mb-2">

            {% for shopping_cart in shopping_cart_items %} 
                <div class="col-sm-6 col-lg-4 mb-0 p-1">
                    <div class="container">
                        <div class="row">  
                            <div class="col-5 col-md-5 col-lg-5 col-xl-4 px-0"> 
                            {% if shopping_cart.drink.image %}  
                                <img class="mb-1 shopping_cart_img rounded" src="/{{ shopping_cart.drink.image }}" alt="{{ shopping_cart.drink.drink_name}}">                                                        
                            {% else %}
                                <img class="mb-1 shopping_cart_img rounded" src="{{ MEDIA_URL }}no-image.png" alt="no image available">  
                            {% endif %}                                                                          
                            </div>
                            <div class="col-7 col-md-7 col-lg-7 col-xl-8 px-0">         
                                <ul class="text-capitalize text-left">
                                    <li><span class="font-weight-bolder">name:</span> {{ shopping_cart.drink.drink_name }}</li>
                                    <li><span class="font-weight-bolder">size:</span> 1x{{ shopping_cart.drink.millilitres }}ml</li>
                                    <li><span class="font-weight-bolder">price:</span> £{{ shopping_cart.drink.price }}</li>
                                    <li><span class="font-weight-bolder">quantity:</span> {{ shopping_cart.drink_quantity }}</li>
                                    <li><span class="font-weight-bolder">total:</span> £{{ shopping_cart.drink.price | calc_subtotal:shopping_cart.drink_quantity }}</li>
                                </ul>                    
                            </div>
                        </div>                
                    </div>
                </div>
            {% endfor %}      
            
            <div class="text-center mb-3">
                <a class="back-to-home-pg-btn text-body bg-secondary mr-2 font-weight-bolder text-uppercase" href="{% url 'shopping_cart' %}">change order</a>
            </div>

        </div>
        <br>        

        <div class="col-12">
            <p>Please enter your payment details to complete your order.</p>
            <form class="payment-form-border p-2 text-body" action="{% url 'checkout' %}" method="POST" id="paymentForm">
                {% csrf_token %}
                {{ drink_order_form.full_name | as_crispy_field }}
                {{ drink_order_form.email | as_crispy_field }}
                {{ drink_order_form.phone_number | as_crispy_field }}
                {{ drink_order_form.street_address1 | as_crispy_field }}
                {{ drink_order_form.street_address2 | as_crispy_field }}
                {{ drink_order_form.postcode | as_crispy_field }}
                {{ drink_order_form.country | as_crispy_field }}
                <label for="#"></label>
                <button type="submit" class="text-uppercase bg-secondary mt-2 form-submit-btn font-weight-bolder">complete order</button>
            </form>
        </div>

        <div class="col-12 px-1">
            {% if user.is_authenticated %}
		    	<label for="#">Save payment details to my profile</label>
                <input type="checkbox" checked>
		    {% else %}
		    	<label for="#">
                    <a class="text-info font-weight-bolder" href="{% url 'account_signup' %}">Create an account</a> or 
                    <a class="text-info font-weight-bolder" href="{% url 'account_login' %}">login</a> to save this information
                </label>
		    {% endif %}
        </div>

        <div class="col-12">
            <p class="small text-danger my-0">
				<span class="icon">
					<i class="fas fa-exclamation-circle"></i>
				</span>
				<span>Your card will be charged <strong>£{{ grand_total|floatformat:2 }}</strong></span>
			</p>
        </div>

    </section>
{% endblock %}
